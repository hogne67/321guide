<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Mediaoversikt</title>
  <link rel="stylesheet" href="admin-layout.css">
</head>
<body>
  <div id="sidebarContainer"></div>
  <div class="main">
    <h1>Mediaoversikt</h1>

    <h2>Last opp ny mediafil</h2>
    <input type="file" id="mediaInput">
    <button onclick="uploadMedia()">Last opp</button>

    <h2>Lagrede filer</h2>
    <ul id="mediaList"></ul>
  </div>

  <script>
    fetch("sidebar.html")
      .then(res => res.text())
      .then(html => document.getElementById("sidebarContainer").innerHTML = html);
  </script>

  <script type="module">
    import { storage } from './firebase-init.js';
    import {
      ref, uploadBytes, getDownloadURL, listAll
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

    const mediaInput = document.getElementById("mediaInput");
    const mediaList = document.getElementById("mediaList");

    async function uploadMedia() {
      const file = mediaInput.files[0];
      if (!file) return alert("Velg en fil f√∏rst");

      const path = `misc-media/${file.name}`;
      const fileRef = ref(storage, path);
      await uploadBytes(fileRef, file);
      const url = await getDownloadURL(fileRef);

      const li = document.createElement("li");
      li.innerHTML = `<a href="${url}" target="_blank">${file.name}</a>`;
      mediaList.appendChild(li);
    }

    async function listMedia() {
      const listRef = ref(storage, 'misc-media/');
      const res = await listAll(listRef);
      mediaList.innerHTML = "";
      for (const itemRef of res.items) {
        const url = await getDownloadURL(itemRef);
        const li = document.createElement("li");
        li.innerHTML = `<a href="${url}" target="_blank">${itemRef.name}</a>`;
        mediaList.appendChild(li);
      }
    }

    listMedia();
    window.uploadMedia = uploadMedia;
  </script>
</body>
</html>
